<div ng-controller="APIKeysController" class="full-height">
  <!-- Header -->
  <div class="row major">
    <div class="col s8 nav-part fill-height z-depth-2">
      <nav class="fill-height">
        <div class="nav-wrapper red major-header">
              <a href="#" data-activates="slide-out" class="side-nav-toggle"> <i class="mdi-navigation-menu"></i></a>
          <ul class="right">
            <li ng-show="!newKey || enableKeySearch" class="tooltipped" data-position="bottom" data-delay="500" data-tooltip="Add key"><a ng-click="showAddKey()"><i class="large-btn mdi-content-add"></i></a></li>
            <li class="tooltipped" data-position="bottom" data-delay="500" data-tooltip="Search"><a ng-click="showSearchBar()"><i class="large-btn mdi-action-search"></i></a></li>
          </ul>
          <br/>
          <!--Major banner import-->
          <div class="row banner">
            <div class="col offset-s1 s11">
              <h3 ng-if="enableKeyAdd == undefined && enableKeySearch == undefined">
                API Keys
              </h3>
              <div ng-show="enableKeySearch != undefined">
                <form class="row" ng-submit="saveKey()">
                  <div class="input-field col s8">
                    <input class="text-h3 validate border-bottom-1px milky-placeholder" id="searchText" type="text" required ng-model="searchKeyNameText" placeholder="API key to search...">
                  </div>
                  <div class="input-field col s4">
                    <a ng-click="cancelSearchBar()" class="btn-flat waves-effect waves-red red darken-2 entity-name-ok-button white-text" type="reset">
                      <i class="mdi-content-clear line-height-36"></i>
                    </a>
                  </div>
                </form>
              </div>

              <div ng-if="enableKeyAdd">
                <form class="row" ng-submit="saveKey()">
                     <div class="input-field col s8">
                       <input class="text-h3 validate border-bottom-1px milky-placeholder" id="newAPIKeyName" type="text" required ng-model="newKey.name" placeholder="New API key name">
                     </div>
                     <div class="input-field col s4">
                       <a ng-click="hideAddKey()" class="btn-flat waves-effect waves-red red darken-2 entity-name-ok-button white-text">
                         <i class="mdi-content-clear line-height-36"></i>
                       </a>
                       &nbsp;&nbsp;
                       <a class="btn-flat waves-effect waves-red red darken-2 entity-name-ok-button white-text" ng-click="saveKey()">
                         <i class="mdi-action-done line-height-36"></i>
                       </a>
                     </div>
                    <div class="modal black-text modal-fixed-footer" id="confirmAddModal">
                      <div class="modal-content">
                        <h4>Are you sure?</h4>
                        <p>You are about to save the following key:</p>
                        <h5>{{newKey.name}}</h5>
                        <table class="hoverable">
                          <thead>
                            <tr>
                              <th>Property</th>
                              <th>Value</th>
                            </tr>
                          </thead>
                          <tbody><!--
                            <tr>
                              <td>Username</td>
                              <td>{{newUser.username}}</td>
                            </tr>
                            <tr>
                              <td>Temporary Password</td>
                              <td>{{newUser.password}}</td>
                            </tr>
                            <tr>
                              <td>To be reset?</td>
                              <td>{{newUser.hasBeenReset}}</td>
                            </tr>
                            <tr>
                              <td>Is user admin?</td>
                              <td>{{newUser.isAdmin}}</td>
                            </tr>
                            <tr>
                              <td>Has user been enabled?</td>
                              <td>{{newUser.isEnabled}}</td>
                            </tr>
                          </tbody>-->
                        </table>
                      </div>
                      <div class="modal-footer">
                        <a href="#" class="waves-effect waves-green btn-flat modal-action modal-close">Cancel</a>
                        <a class="waves-effect waves-green btn-flat modal-action" ng-click="confirmSave()">Save</a>
                      </div>
                    </div>

                    <div class="modal black-text modal-fixed-footer" id="confirmResetKey">
                      <div class="modal-content">
                        <h4>Are you sure?</h4>
                        <p>Do you want to reset all fields of the current key that is being created?</p>
                        <h5>{{newKey.name}}</h5>
                        <!--<div class="row">
                        <table class="col s6">
                          <thead>
                            <tr>
                              <th>Property</th>
                              <th>Value</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>Username</td>
                              <td>{{newUser.username}}</td>
                            </tr>
                            <tr>
                              <td>Temporary Password</td>
                              <td>{{newUser.password}}</td>
                            </tr>
                            <tr>
                              <td>To be reset?</td>
                              <td>{{newUser.hasBeenReset}}</td>
                            </tr>
                            <tr>
                              <td>Is user admin?</td>
                              <td>{{newUser.isAdmin}}</td>
                            </tr>
                            <tr>
                              <td>Has user been enabled?</td>
                              <td>{{newUser.isEnabled}}</td>
                            </tr>
                          </tbody>
                        </table>
                          <div class="col s6"></div>
                        </div>-->
                      </div>
                      <div class="modal-footer">
                        <a href="#" class="waves-effect waves-green btn-flat modal-action modal-close">Cancel</a>
                        <a class="waves-effect waves-green btn-flat modal-action modal-close" ng-click="showAddKey(true)">Yes, Reset</a>
                      </div>
                    </div>

                  <div class="modal black-text modal-fixed-footer" id="confirmCancelKeyCreation">
                    <div class="modal-content">
                      <h4>Are you sure?</h4>
                      <p>Do you want to discard all the changes to the following key?</p>
                      <h5>{{newKey.name}}</h5>
                      <!--<div class="row">
                        <table class="col s6">
                          <thead>
                          <tr>
                            <th>Property</th>
                            <th>Value</th>
                          </tr>
                          </thead>
                          <tbody>
                          <tr>
                            <td>Username</td>
                            <td>{{newUser.username}}</td>
                          </tr>
                          <tr>
                            <td>Temporary Password</td>
                            <td>{{newUser.password}}</td>
                          </tr>
                          <tr>
                            <td>To be reset?</td>
                            <td>{{newUser.hasBeenReset}}</td>
                          </tr>
                          <tr>
                            <td>Is user admin?</td>
                            <td>{{newUser.isAdmin}}</td>
                          </tr>
                          <tr>
                            <td>Has user been enabled?</td>
                            <td>{{newUser.isEnabled}}</td>
                          </tr>
                          </tbody>
                        </table>
                        <div class="col s6"></div>
                      </div>-->
                    </div>
                    <div class="modal-footer">
                      <a href="#" class="waves-effect waves-green btn-flat modal-action modal-close">Cancel</a>
                      <a class="waves-effect waves-green btn-flat modal-action modal-close" ng-click="hideAddKey(true)">Yes, Discard</a>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </div>
    <div class="col s4 nav-part fill-height">
      <nav class="fill-height">
        <div class="nav-wrapper red darken-2 minor-header">
          <ul class="right">
            <!--<li ng-show="(newKey || editKey == true) && permissionsPanel == true" class="tooltipped" data-position="bottom" data-delay="500" data-tooltip="Add permission"><a ng-click="broadcastAddPermission()"><span class="large-btn mdi-content-add"></span></a></li>-->
            <li>&nbsp;</li>
          </ul>

          <div class="row">
            <div class="col offset-s1 s11">
              <h5 class="instance-header" ng-hide="newKey">{{key.name}}</h5>
              <h5 class="instance-header" ng-show="newKey && newKey.name">{{newKey.name}}</h5>

              <span class="instance-tagline" ng-show="key && key.lastAccessDate">Last accessed {{key.lastAccessDate | date: 'medium'}}.</span>
              <span class="instance-tagline" ng-show="key && !key.lastAccessDate">Last accessed <em>never</em>.</span>
            </div>
          </div>
        </div>
      </nav>
    </div>
  </div>
  <!-- Content Body -->
  <div class="main-container">
    <div class="row full-height">
      <div class="col s8 table-div nopadding major-body z-depth-1" ng-controller="APIKeysListController">
        <div class="major-body-list-header">
          <div class="row table-header-row">
            <div class="col s1 table-header">&nbsp;</div>
            <div class="col s5 table-header bottom-bordered shift-25px-right">Name</div>
            <div class="col s3 table-header text-align-center bottom-bordered shift-14px-right">API Key</div>
            <div class="col s2 table-header text-align-center bottom-bordered shift-7px-right">Is Active?</div>
            <!--<div class="col s2 table-header text-align-center bottom-bordered"></div>-->
            <div class="col s1 table-header bottom-bordered">&nbsp;</div>
          </div>
        </div>
        <div class="major-body-list-body">
          <div ng-click="view(key)" class="row table-row valign-wrapper link" ng-repeat="key in keyList | filter:keySearchFilter">
            <div class="col s1 table-cell" ng-click="view(key)"><span class="mdi-social-person large-text round-icon"></span></div>
            <div class="col s5 table-cell" ng-click="view(key)">{{key.name}}</div>
            <div class="col s3 table-cell center" ng-click="view(key)">
              <div class="right-align">
                <button class="waves-effect waves-light btn btn-row" ng-click="copyToClipboard(key.apiKey)">Copy to clipboard</button>
              </div>
            </div>
            <div class="col s2 table-cell" ng-click="view(key)">
              <div class="center">
                <span ng-if="key.active == true" class="mdi-action-done medium-text green-text"></span>
                <span ng-if="!key.active || key.active == false" class="mdi-navigation-close medium-text red-text"></span>
              </div>
            </div>
            <!--<div class="col s2 table-cell" ng-click="view(user)">
              <div class="center">
                <span ng-if="user.isEnabled" class="mdi-action-done medium-text green-text"></span>
                <span ng-if="!user.isEnabled || user.isEnabled == false" class="mdi-navigation-close medium-text red-text"></span>
              </div>
            </div>-->
            <div class="col s1 table-cell">
              <a material-dropdown class='dropdown-button text-center' href="#" ng-attr-data-activates='{{"dropdown" + $index}}'><span class="mdi-navigation-more-vert medium-text"></span></a>
              <ul ng-attr-id='{{"dropdown" + $index}}' class='dropdown-content'>
                <li><a ng-click="deleteKey(key)">Delete</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="col s4 nopadding" ng-controller="APIKeyPropertyController">
        <div class="property-panel">
          <div class="property-panel-body">
            <div ng-show="$parent.newKey">
              <div class="property-panel-header">
                <div class="row table-header-row">
                  <div class="col s5 table-header bottom-bordered shift-25px-right">Action</div>
                  <div class="col s5 table-header bottom-bordered shift-7px-right">Realm</div>
                  <div class="col s2 table-header bottom-bordered shift-7px-right">&nbsp;</div>
                </div>
              </div>
              <div class="row table-row valign-wrapper" on-finish-render="initializeMaterialSelect" ng-repeat="permission in newKey.permissions" ng-class="{'shake z-depth-4':permission.attention == true}">
                <div class="col s5 table-cell">
                  <select ng-model="permission.action" ng-options="action1 as action1 for action1 in allowedActions"></select>
                </div>
                <div class="col s5 table-cell">
                  <span>
                    <select ng-model="permission.realm" ng-options="realm1 as realm1 for realm1 in allowedRealms"></select>
                  </span>
                </div>
                <div class="col s2 table-cell">
                  <a ng-if="newKey.permissions.length > 1" material-dropdown class='dropdown-button text-center' href="#" ng-attr-data-activates='{{"dropdown" + $index}}'><span class="mdi-navigation-more-vert medium-text"></span></a>
                  <ul ng-if="newKey.permissions.length > 1" ng-attr-id='{{"dropdown" + $index}}' class='dropdown-content'>
                    <li><a ng-click="removePropertyAt($index)">Remove</a></li>
                  </ul>
                </div>
              </div>
          </div>
          <div ng-show="key != undefined && !$parent.newKey">
            <div class="property-panel-header">
              <div class="row table-header-row">
                <div class="col s6 table-header bottom-bordered shift-25px-right">Action</div>
                <div class="col s6 table-header bottom-bordered shift-7px-right">Realm</div>
              </div>
            </div>
            <div class="row table-row valign-wrapper" on-finish-render="initializeMaterialSelect" ng-repeat="permission in key.permissions">
              <div class="col s6 table-cell">
                {{permission.action}}
              </div>
              <div class="col s6 table-cell">
                {{permission.realm}}
              </div>
            </div>
          </div>
        </div>
      </div>
        <!--<div ng-if="!true" class="instance-list-panel minor-body-bottom" ng-controller="RoleListController">
          <hr/>
          <a ng-show="user" href="#modal1" id="action-button" class="btn-floating btn-large waves-effect waves-light red instance-list-button pull-right medium-text modal-trigger">{ }</a>
          <div class="card action-card dropdown-content" id="modal1">
            <div class="valign-wrapper">
              <span class="action-label">Delete role</span> &nbsp;&nbsp; <a href="#" class="btn-floating btn-large btn-floating-small waves-effect waves-light pink darken-3 modal-close"><i class="mdi-action-delete no-line-height"></i></a>
            </div>
            <div class="valign-wrapper">
              <span class="action-label">Edit role</span> &nbsp;&nbsp; <a href="#" class="btn-floating btn-large btn-floating-small waves-effect waves-light pink darken-3 modal-close"><i class="mdi-image-edit no-line-height"></i></a>
            </div>
            <div class="valign-wrapper">
              <span class="action-label">Find role</span> &nbsp;&nbsp; <a href="#" class="btn-floating btn-large btn-floating-small waves-effect waves-light pink darken-3 modal-close"><i class="mdi-action-search no-line-height"></i></a>
            </div>
            <div class="valign-wrapper">
              <span class="action-label">New role</span> &nbsp;&nbsp; <a href="#" class="btn-floating btn-large btn-floating-small waves-effect waves-light pink darken-3 modal-close"><i class="mdi-content-add no-line-height"></i></a>
            </div>
            <div class="valign-wrapper cancel-action-card-button">
              <span class="action-dismiss-label">Close</span> &nbsp;&nbsp; <a href="#" class="btn-floating btn-large waves-effect waves-light red modal-close"><i class="mdi-content-clear modal-close"></i></a>
            </div>
          </div>
          <textarea class="materialize-textarea full-height no-border-bottom instance-list-textarea" disabled>{{roleString}}</textarea>
        </div>-->
      </div>
    </div>
  </div>
  <script>
    // Must always be placed at the end of the script.
    $(document).unbind('ready');
    $(document).ready(function() {
      $('.modal-trigger').leanModal();
      $('.side-nav-toggle').sideNav({
          menuWidth: 300, // Default is 240
          edge: 'left', // Choose the horizontal origin
          closeOnClick: true // Closes side-nav on <a> clicks, useful for Angular/Meteor
        }
      );
    });

    $(document).mouseup(function(e) {
      var dropdown = $("ul.dropdown-content[visible=visible]");
      if(dropdown){
        dropdown.animate({
          'opacity': '0'
        });
        dropdown.hide();
        dropdown.removeAttr("visible");
      }
    });


  </script>
</div>